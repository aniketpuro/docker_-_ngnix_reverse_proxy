version: "3.8"  # Using Docker Compose version 3.8 for compatibility and features

services:

  # ----------------------------------------
  # ğŸŸ¦ Service 1 (Golang)
  # ----------------------------------------
  service_1:
    container_name: service_1  # ğŸ‘ˆ Custom container name (no project prefix)
    build:
      context: ./service_1     # ğŸ“ Build context points to the Go service directory
    expose:
      - "8001"                 # ğŸ”“ Exposes port internally (used by nginx)
    healthcheck:               # âœ… Health check to monitor service health
      test: ["CMD", "curl", "-f", "http://localhost:8001/"]
      interval: 30s
      timeout: 10s
      retries: 3
    entrypoint: sh -c "echo '[service_1] ğŸŸ¢ Process started'; ./main"  
    # ğŸ“ Adds log for process start, then runs compiled Go binary

  # ----------------------------------------
  # ğŸŸ¨ Service 2 (Python + Flask)
  # ----------------------------------------
  service_2:
    container_name: service_2  # ğŸ‘ˆ Custom container name
    build:
      context: ./service_2     # ğŸ“ Build context for Flask service
    expose:
      - "8002"                 # ğŸ”“ Exposes port for internal Nginx routing
    healthcheck:               # âœ… Health check for Flask
      test: ["CMD", "curl", "-f", "http://localhost:8002/"]
      interval: 30s
      timeout: 10s
      retries: 3
    entrypoint: sh -c "echo '[service_2] ğŸŸ¢ Process started'; python3 app.py"
    # ğŸ“ Logs process start and launches app.py

  # ----------------------------------------
  # ğŸ”µ Nginx Reverse Proxy
  # ----------------------------------------
  nginx:
    container_name: nginx      # ğŸ‘ˆ Custom name to remove prefix
    build:
      context: ./nginx         # ğŸ“ Dockerfile + nginx.conf lives here
    ports:
      - "8080:80"              # ğŸŒ Exposes Nginx on host port 8080
    depends_on:
      - service_1              # â³ Waits for service_1 to start
      - service_2              # â³ Waits for service_2 to start
    healthcheck:               # âœ… Basic check to verify Nginx is routing
      test: ["CMD", "curl", "-f", "http://localhost:8080/"]
      interval: 30s
      timeout: 10s
      retries: 3
    entrypoint: sh -c "echo '[nginx] ğŸŸ¢ Reverse proxy started on port 8080'; nginx -g 'daemon off;'"
    # ğŸ“ Logs reverse proxy start and keeps Nginx running in foreground